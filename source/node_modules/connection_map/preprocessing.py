import json
import copy

file1 = "inter_war_data.json"
file2 = "cshapes.json"

with open(file1, 'r') as f:
	war = json.load(f)
	data1 = war["war_data"]

with open(file2, 'r') as f:
	shapes = json.load(f)
	data2 = shapes["features"]

# print(data[1])
j = 0
rem = []
for i in range(len(data2)):
	if (data2[i-j]['properties']['COWCODE'] == -1 or data2[i-j]['properties']['COWEYEAR'] != 2016):
		p = data2.pop(i-j)
		rem.append(p['properties']['COWCODE'])
		# print(p['properties']['CNTRY_NAME'] + ": " + str(p['properties']['COWCODE']))
		j += 1

# print(str(j) + " has been removed")

keys = ["GWCODE", "COWSYEAR", "COWSMONTH", "COWSDAY", "COWEYEAR", "COWEMONTH", "COWEDAY", "FEATUREID", "AREA", "CAPNAME", "CAPLONG", "CAPLAT", "GWSYEAR", "GWSMONTH", "GWSDAY", "GWEYEAR", "GWEMONTH", "GWEDAY", "ISONAME", "ISO1NUM", "ISO1AL2", "ISO1AL3"]

for obj in data2:
	for k in keys:
		del obj['properties'][k]

data2.sort(key = lambda x: x['properties']['CNTRY_NAME'])

# for obj in data2:
# 	print(obj['properties'])

cow_codes = list(map(lambda x: x['properties']['COWCODE'], data2))

# print(cow_codes)

out = []

for w in data1:
	if (w['ccode'] not in cow_codes):
		# print(w['state_name'] + ": " + str(w['ccode']))
		out.append(w['ccode'])

add = {327: [325], 329: [325], 267: [255], 300: [316, 317, 305, 310, 349, 344, 346, 325, 290, 369, 360, 345], 332: [325], 269: [255], 271: [255], 240: [255], 337: [325], 273: [255], 275: [255], 245: [255], 280: [255], 678: [679], 817: [816], 315: [316, 317]}
l = len(data1)
for i in range(l):
	if data1[i]['ccode'] in add:
		aux = data1[i]['ccode']
		print(aux)
		for c in add[aux]:
			data1.append(copy.deepcopy(data1[i]))
			data1[-1]['ccode'] = c
			# new['ccode'] = c
			# print(new)
			# data1.append(new)


# print(set(out))
# print(set(rem))

# wars = list(filter(lambda x: x['ccode'] not in set(out), data1))
wars = data1

connect = []
for obj in data2:
	c = obj['properties']['COWCODE']
	n = obj['properties']['CNTRY_NAME']
	w = list(map(lambda x: (x['war_id'],x['side']), filter(lambda x: x['ccode'] == c, wars)))
	e = []
	for i in w:
		e += list(map(lambda x: x['ccode'], filter(lambda x: (x['war_id'] == i[0]) and (x['ccode'] != c) and (x['side'] != i[1]), wars)))

	e = list(set(e))
	w = list(set(map(lambda x: x[0], w)))
	obj['properties'] = {'code': c, 'name': n, 'wars': w, 'enemies': e}
	print(obj['properties'])

# outf = json.dumps(connect)
outf = json.dumps({"type":"FeatureCollection","features":data2})
# print(outf)


with open("shapes.json", 'w') as f:
	f.write("shapes = " + outf)

'''
NÃƒO TEM "SHAPES"

Papal States: 327 -> 325
Two Sicilies: 329 -> 325
Baden: 267 -> 255
Austria-Hungary: 300 -> 316, 317, 305, 310, 349, 344, 346 (325, 290, 369, 360, 345)
Modena: 332 -> 325
Saxony: 269 -> 255 (325)
Wuerttemburg: 271 -> 255
Hanover: 240 -> 255 (210)
Tuscany: 337 -> 325
Hesse Electoral: 273 -> 255
Hesse Grand Ducal: 275 -> 255
Bavaria: 245 -> 255
Mecklenburg Schwerin: 280 -> 255

##############################################

TEM "SHAPES"

Yemen Arab Republic: 678 -> 679
Republic of Vietnam: 817 -> 816
Czechoslovakia: 315 -> 316, 317
'''
