function generateClassesDataset(original_dataset) {
    var attributes = Array.prototype.slice.call(arguments, 1)
    var spans_dataset = generateWarSpansDataset(original_dataset, attributes)
    var classes = [{"id": 0, "last_end_date": new Date(-1,-1,-1)}]
    var new_dataset = []

    for(i=0; i<spans_dataset.length; i++){
        var war = Object.assign({}, spans_dataset[i])
        war.class = null
        
        for(j=0; j<classes.length; j++){
            if(war.start_date > classes[j].last_end_date){
                war.class = classes[j].id
                classes[j].last_end_date = war.end_date
                break
            }
        }

        if(war.class == null){
            war.class = classes.length
            classes.push({"id": classes.length, "last_end_date": war.end_date})
        }

        new_dataset.push(war)
    }

    return new_dataset
}

function generateWarSpansDataset(wars){
    var war_spans = []
    var current_war = {"war_id": null, "start_date": null, "end_date": null}
    
    for(i=0; i<wars.length; i++){
        var country = wars[i]
        if(country.war_id == current_war.war_id){
            country_span = getCountrySpanInWar(country)
            var start_date = country_span.start_date
            var end_date = country_span.end_date

            if(start_date < current_war.start_date){
                current_war.start_date = start_date
            }

            if(end_date > current_war.end_date){
                current_war.end_date = end_date
            }
        }
        else{
            if(current_war.war_id != null){
                war_spans.push(Object.assign({}, current_war))
            }

            current_war.war_id = country.war_id

            var country_span = getCountrySpanInWar(country)
            current_war.start_date = country_span.start_date
            current_war.end_date = country_span.end_date
            
            var attributes = Array.prototype.slice.call(arguments, 1)
            for(j=0; j<attributes.length; j++){
                if(attributes[j] !== undefined) {
                    current_war[attributes[j]] = country[attributes[j]]
                }
            }
        }
    }

    return war_spans
}

function getCountrySpanInWar(country){
    var start_date = new Date()
    start_date.setFullYear(country.start_year1, country.start_month1-1, country.start_day1)
    
    var end_date = new Date()
    if(country.end_year2 == -8){
        end_date.setFullYear(country.end_year1, country.end_month1-1, country.end_day1)
    }
    else{
        end_date.setFullYear(country.end_year2, country.end_month2-1, country.end_day2)
    }

    var country_span = {"start_date": start_date, "end_date": end_date}

    return country_span
}
